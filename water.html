<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜äººä¸è¯´ç‘è¯</title>
  <style>
    /* å…¨å±€ç®€çº¦æ ·å¼ï¼Œé€‚é…æ‰‹æœº+ç”µè„‘ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    body {
      background-color: #fdf2f8;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      width: 100%;
      max-width: 400px;
    }
    .title {
      text-align: center;
      font-size: 24px;
      margin-bottom: 30px;
      color: #e53e3e;
    }
    /* è®¡æ•°å¡ç‰‡æ ·å¼ */
    .count-card {
      margin-bottom: 25px;
    }
    .card-title {
      font-size: 18px;
      margin-bottom: 10px;
      color: #4a5568;
    }
    .count-display {
      font-size: 60px;
      font-weight: bold;
      text-align: center;
      margin: 15px 0;
      color: #e53e3e;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-add {
      background-color: #e53e3e;
      color: white;
    }
    .btn-add:hover {
      background-color: #c53030;
    }
    .btn-reset {
      background-color: #e2e8f0;
      color: #4a5568;
    }
    .btn-reset:hover {
      background-color: #cbd5e1;
    }
    /* å¾…è¿˜æ¬¡æ•°æ¨¡å— */
    .debt-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #f0f0f0;
      text-align: center;
    }
    .debt-title {
      font-size: 18px;
      margin-bottom: 10px;
      color: #4a5568;
    }
    .debt-display {
      font-size: 28px;
      font-weight: bold;
      color: #9f7aea;
    }
    /* åº•éƒ¨é‡ç½®æ‰€æœ‰æŒ‰é’® */
    .reset-all-btn {
      margin-top: 30px;
      background-color: #38b2ac;
      color: white;
    }
    .reset-all-btn:hover {
      background-color: #319795;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">æ˜äººä¸è¯´ç‘è¯</h1>

    <!-- æˆ‘çš„å–æ°´è®¡æ•° -->
    <div class="count-card">
      <h2 class="card-title">æ˜å“¥å–æ°´æ¬¡æ•°</h2>
      <div class="count-display" id="myCount">0</div>
      <div class="btn-group">
        <button class="btn btn-add" onclick="addMyCount()">+1 å–æ°´å•¦</button>
        <button class="btn btn-reset" onclick="resetMyCount()">å½“æˆ‘æ²¡å–</button>
      </div>
    </div>

    <!-- å¥³å‹å–æ°´è®¡æ•° -->
    <div class="count-card">
      <h2 class="card-title">ç‘å®çš„å–æ°´æ¬¡æ•°</h2>
      <div class="count-display" id="herCount">0</div>
      <div class="btn-group">
        <button class="btn btn-add" onclick="addHerCount()">+1 å–æ°´å•¦</button>
        <button class="btn btn-reset" onclick="resetHerCount()">å½“æˆ‘æ²¡å–</button>
      </div>
    </div>

    <!-- å¾…è¿˜æ¬¡æ•° -->
    <div class="debt-section">
      <h2 class="debt-title">å·²æ¬ å–æ°´æ¬¡æ•°</h2>
      <div class="debt-display" id="debtCount">è°éƒ½ä¸æ¬ </div>
    </div>

    <!-- é‡ç½®æ‰€æœ‰ -->
    <button class="btn reset-all-btn" onclick="resetAllCount()">åœ°çƒçˆ†ç‚¸</button>
  </div>

<!-- ä½¿ç”¨ LeanCloud å®˜æ–¹å›½å†… CDNï¼ˆæ¨èï¼ï¼‰ -->
<script src="https://cdn.leancloud.cn/sdk/4.17.0/av-min.js"></script>
  <script>
    // åˆå§‹åŒ–LeanCloudï¼ˆä½ çš„å‡­è¯å·²å¡«å¥½ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
    AV.init({
      appId: "M8zwM2yOHUsaxGVqnJiS5tkF-gzGzoHsz",
      appKey: "wjQzkjEjzoExbIeRAIVTvTn6",
      serverURL: "https://m8zwm2yo.lc-cn-n1-shared.com"
    });

    // å®šä¹‰æ•°æ®æ¨¡å‹
    const DrinkRecord = AV.Object.extend('DrinkRecord');

    // é¡µé¢åŠ è½½è·å–æœ€æ–°æ•°æ®ï¼ˆå…¼å®¹Promiseï¼Œé¿å…async/awaitæŠ¥é”™ï¼‰
    window.onload = function() {
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(result) {
        if (result) {
          const myCount = result.get('myCount') || 0;
          const herCount = result.get('herCount') || 0;
          document.getElementById('myCount').innerText = myCount;
          document.getElementById('herCount').innerText = herCount;
          updateDebtCount(myCount, herCount);
        }
      }).catch(function(err) {
        console.log('åŠ è½½æ•°æ®æç¤ºï¼š', err.message);
      });
    };

    // è®¡ç®—å¾…è¿˜æ¬¡æ•°
    function updateDebtCount(myCount, herCount) {
      const debtDisplay = document.getElementById('debtCount');
      const diff = Number(myCount) - Number(herCount);
      if (diff === 0) {
        debtDisplay.innerText = "è°éƒ½ä¸æ¬ ";
      } else if (diff > 0) {
        debtDisplay.innerText = `ç‘å®æ¬ æ˜å“¥ ${diff} æ¬¡å–æ°´ğŸ˜œ`;
      } else {
        debtDisplay.innerText = `æ˜å“¥æ¬ ç‘å® ${-diff} æ¬¡å–æ°´ğŸ¥º`;
      }
    }

    // æ˜å“¥å–æ°´+1ï¼ˆPromiseå†™æ³•ï¼Œå…¼å®¹æ‰€æœ‰ç¯å¢ƒï¼‰
    function addMyCount() {
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(record) {
        if (!record) record = new DrinkRecord();
        const current = record.get('myCount') || 0;
        const newCount = current + 1;
        record.set('myCount', newCount);
        return record.save();
      }).then(function() {
        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        const herCount = document.getElementById('herCount').innerText;
        const newMyCount = Number(document.getElementById('myCount').innerText) + 1;
        document.getElementById('myCount').innerText = newMyCount;
        updateDebtCount(newMyCount, herCount);
      }).catch(function(err) {
        alert('è®¡æ•°å¤±è´¥å•¦ï½è¯•è¯•åˆ·æ–°é¡µé¢');
        console.log('æ˜å“¥è®¡æ•°é”™è¯¯ï¼š', err);
      });
    }

    // ç‘å®å–æ°´+1ï¼ˆå®Œæ•´å®šä¹‰ï¼Œç»å¯¹ä¸æŠ¥é”™ï¼‰
    function addHerCount() {
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(record) {
        if (!record) record = new DrinkRecord();
        const current = record.get('herCount') || 0;
        const newCount = current + 1;
        record.set('herCount', newCount);
        return record.save();
      }).then(function() {
        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        const myCount = document.getElementById('myCount').innerText;
        const newHerCount = Number(document.getElementById('herCount').innerText) + 1;
        document.getElementById('herCount').innerText = newHerCount;
        updateDebtCount(myCount, newHerCount);
      }).catch(function(err) {
        alert('è®¡æ•°å¤±è´¥å•¦ï½è¯•è¯•åˆ·æ–°é¡µé¢');
        console.log('ç‘å®è®¡æ•°é”™è¯¯ï¼š', err);
      });
    }

    // é‡ç½®æ˜å“¥æ¬¡æ•°
    function resetMyCount() {
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(record) {
        if (record) {
          record.set('myCount', 0);
          return record.save();
        }
      }).then(function() {
        document.getElementById('myCount').innerText = 0;
        const herCount = document.getElementById('herCount').innerText;
        updateDebtCount(0, herCount);
      }).catch(function(err) {
        console.log('é‡ç½®æ˜å“¥é”™è¯¯ï¼š', err);
      });
    }

    // é‡ç½®ç‘å®æ¬¡æ•°
    function resetHerCount() {
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(record) {
        if (record) {
          record.set('herCount', 0);
          return record.save();
        }
      }).then(function() {
        document.getElementById('herCount').innerText = 0;
        const myCount = document.getElementById('myCount').innerText;
        updateDebtCount(myCount, 0);
      }).catch(function(err) {
        console.log('é‡ç½®ç‘å®é”™è¯¯ï¼š', err);
      });
    }

    // é‡ç½®æ‰€æœ‰æ¬¡æ•°
    function resetAllCount() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å–æ°´è®°å½•å—')) return;
      const query = new AV.Query('DrinkRecord');
      query.descending('createdAt');
      query.first().then(function(record) {
        if (record) {
          record.set('myCount', 0);
          record.set('herCount', 0);
          return record.save();
        }
      }).then(function() {
        document.getElementById('myCount').innerText = 0;
        document.getElementById('herCount').innerText = 0;
        updateDebtCount(0, 0);
      }).catch(function(err) {
        console.log('é‡ç½®æ‰€æœ‰é”™è¯¯ï¼š', err);
      });
    }
  </script>
</body>
</html>